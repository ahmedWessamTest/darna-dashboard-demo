<div class="flex justify-content-between items-center mb-4 w-full">
  <h2>Projects Management</h2>
  <p-button
    label="Create New Project"
    icon="pi pi-plus"
    [routerLink]="['create']"
    severity="primary">
  </p-button>
</div>

<!-- Search Section -->
<div class="mb-4">
  <div class="flex gap-4 align-items-center">
    <div class="flex-1">
      <label for="search" class="block text-sm font-medium mb-2"
        >Search by Project Name:</label
      >
      <input
        pInputText
        id="search"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        placeholder="Enter project name to search..."
        class="w-full"
        styleClass="w-full" />
    </div>
  </div>
</div>

<p-table [value]="projects" [tableStyle]="{ 'min-width': '50rem' }">
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="id">
        ID
        <p-sortIcon field="id"></p-sortIcon>
      </th>
      <th pSortableColumn="en_project_name">
        Title
        <p-sortIcon field="en_project_name"></p-sortIcon>
      </th>
      <th>Image</th>
      <th pSortableColumn="en_project_name">
        Name
        <p-sortIcon field="en_project_name"></p-sortIcon>
      </th>
      <th>View</th>
      <th>Edit</th>
      <th style="max-width: 50px" pSortableColumn="active_status">
        <div class="flex flex-column gap-2">
          <span>Status</span>
          <p-select
            [options]="statusOptions"
            [(ngModel)]="selectedStatusFilter"
            (ngModelChange)="onStatusFilter($event)"
            optionLabel="label"
            optionValue="value"
            [showClear]="true"
            appendTo="body"
            placeholder="Filter by Status" />
        </div>
      </th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-project>
    <tr>
      <td>{{ project.id }}</td>
      <td style="width: 25%">{{ project.en_project_name }}</td>
      <td>
        <img
          [src]="baseUrl + project.main_image"
          alt="project"
          [style]="{ width: '50px', height: '50px', borderRadius: '50%' }" />
      </td>
      <td>{{ project.en_project_name }}</td>
      <td>
        <a [routerLink]="['view', project.id]">
          <i class="pi pi-eye" style="color: #673ab7"></i>
        </a>
      </td>
      <td>
        <a [routerLink]="['edit', project.id]">
          <i class="pi pi-pencil" style="color: #673ab7"></i>
        </a>
      </td>
      <td>
        <div class="flex align-items-center gap-2">
          <p-toggleswitch
            [ngModel]="returnStatus(project.active_status)"
            (ngModelChange)="onToggleChange(project)"
            [disabled]="isToggleLoading(project.id)" />

          <!-- Loading indicator -->
          @if (isToggleLoading(project.id)) {
          <i
            class="pi pi-spin pi-spinner"
            style="color: #673ab7; font-size: 0.8rem">
          </i>
          }
        </div>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="7" class="text-center p-4">
        <div class="flex flex-column align-items-center justify-content-center">
          <i
            class="pi pi-info-circle"
            style="font-size: 2rem; color: var(--text-color-secondary)"></i>
          <span class="mt-2" style="color: var(--text-color-secondary)"
            >No data found</span
          >
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>

<!-- Pagination -->
<div class="mt-4">
  <p-paginator
    [first]="first"
    [rows]="rows"
    [totalRecords]="totalRecords"
    [rowsPerPageOptions]="paginationOptions"
    [showPageLinks]="true"
    [showCurrentPageReport]="true"
    [showFirstLastIcon]="true"
    [showJumpToPageDropdown]="false"
    [showJumpToPageInput]="false"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    (onPageChange)="onPageChange($event)">
  </p-paginator>
</div>
